了解！貼ってくれた XGBoost コード（v2.0）の中身を読んで、どのセンサー由来の特徴量がどれくらいあるかを“数の規模感”でまとめました。結論から言うと、\*\*使っている特徴量はセンサーフュージョン（IMU ＋ ToF ＋ Thermal ＋品質＋デモグラ＋クロスモーダル）**で、**数（次元）で見ると ToF 由来が圧倒的多数**、IMU は重要ではあるものの**全体の一部（≒ 数％）\*\*です。

# 全体の内訳（概算）

前提：ToF 5 台・PCA=8 成分・Thermal 5 本・サンプリング 20Hz。列名が揃っている前提で、実装関数が吐き出す“標準”の本数を足し上げた概算です。

- **IMU 由来 合計 \~814 次元（約 5%）**

  - acc_x/y/z：統計＋ Hjorth ＋ピーク＋ライン長＋自己相関＋勾配ヒスト＋周波数 = **64 × 3 = 192**
  - acc\_合成（acc_mag）：各種 = **54**
  - クォータニオン 4 成分の統計 = **104**
  - world_acc_x/y/z：統計＋周波数 = **43 × 3 = 129**
  - world_acc_mag：統計＋ Hjorth ＋周波数 = **46**
  - linear_acc_x/y/z：統計 = **26 × 3 = 78**
  - linear_acc_mag：統計＋ Hjorth = **29**
  - 角速度\_x/y/z：統計 = **26 × 3 = 78**, 角速度合成= **26**
  - オイラー角（roll/pitch/yaw）：統計 = **26 × 3 = 78**

- **ToF 由来 合計 \~14,200 次元（約 92%）**

  - フレーム空間/領域/クラスタ/異方性/近接など**49 項目**をフレーム時系列で集約（各項目ごとに 時系列統計 26 ＋速度系列統計 26 = **52**）
    → **49 × 52 ≈ 2,548 / センサ × 5 = 12,740**
  - min_dist（各センサの最小距離時系列）：統計 26 ＋ Hjorth3 ＋到着イベント 3 = **32 / センサ × 5 = 160**
  - valid_ratio 時系列の統計：**26 / センサ × 5 = 130**
  - **ToF PCA（8 成分）**：各成分の時系列統計 26 × 8 + 再構成誤差の統計 26 = **234 / センサ × 5 = 1,170**
  - **センサ間同期**（同時近接率・平均ラグ・コヒーレンス）= **3（全体で一度）**
  - **全センサのグローバル min**：統計 26 ＋ Hjorth3 = **29（全体で一度）**
  - **IMU×ToF 整合**（acc ピークと ToF 近接の整合＆相関）= **3/センサ × 5 = 15**

- **Thermal 由来 合計 \~400 次元（約 2.6%）**

  - 1 本あたり：統計 26 ＋一次差分の統計 26 ＋トレンド（傾き/切片）2 ＋二次差分の統計 26 = **80**
  - Thermal が 5 本なら **80 × 5 = 400**

- **品質（Quality）＋デモグラ（subject, age, handedness）＋その他クロス**

  - 品質の基礎：sequence_length, IMU/Quat の valid 比率や連続欠測、ToF 各センサの valid 分位などで **\~38 + 2×(Thermal 本数)**
    （Thermal5 本なら **\~48**）
  - デモグラ：**3**
  - 既述の同期/グローバル/IMU×ToF 整合は上に計上済み

- **総数（概算）**：**\~15.5k 次元**

  - 内訳比率目安：**ToF \~91–92% / IMU \~5% / Thermal \~2–3% / 残り \~1%弱**

> 注：実データの列構成（Thermal 本数など）や設定（例：PCA 成分数、センサ台数）で前後しますが、\*\*「ToF が桁違いに多い」\*\*という傾向は変わりません。

# それぞれ“何を”特徴量化しているか（要点）

- **IMU**

  - 生加速度・合成・世界座標加速度・**線形加速度（重力除去）**・角速度（クォータニオン差分）・オイラー角
  - 統計・Hjorth・ピーク・自己相関・勾配ヒスト・**周波数（0.3–3 / 3–8 / 8–12Hz：絶対/相対/対数パワー、重心、ロールオフ、エントロピー、支配周波数、ZCR、総パワー、LF/HF 比）**・**ジャーク**

- **ToF（8×8 距離画像）**

  - **利き手に応じた水平反転**（handedness ミラー）
  - 有効比率・**重心/モーメント/偏心率/エッジ/グラディエント**
  - **中心/内輪/外輪/象限**などの領域統計・上下左右非対称・**近接割合（分位）**・**クラスタサイズ/円形度**・**異方性（PCA 固有値/主方向）**
  - それら**各フレーム 49 項目を時系列で集約（統計＋“変化速度”）**
  - **min 距離時系列**（統計/Hjorth/到着イベント）
  - **PCA 特徴（8 成分）＋再構成誤差**
  - **センサ間同期（相関/時間ラグ/同時近接率）**、**IMU ピークとの整合**

- **Thermal**

  - 統計・一次/二次差分の統計・**トレンド（線形回帰の傾き/切片）**・変化イベント率（実装あり）

- **品質（Quality）**

  - IMU/Quat/ToF/Thermal ごとの**有効比率**、**最大連続欠測**、ToF の**有効ピクセル分位**など

- **デモグラ**

  - subject, age, handedness（数値でそのまま入っています）

# 補足（気づき）

- **マルチ解像度特徴**：コードにはありますが、フラグ名が
  `CONFIG["use_multi_resolution"]=True` に対して、参照側が `self.config.get("multi_resolution", False)` になっており**実際には無効**になっています（有効化するならキー名を合わせる）。
- **subject を特徴量に含めている**：GroupKFold で学習時リークは抑えているものの、**本番の未知 subject には不要/危険**なので、基本は落とすほうが安全です。
- **次元が非常に多い**（主に ToF）。XGBoost なら扱えますが、\*\*colsample や正則化を強める／特徴選択（CV での Permutation Importance・相関の高い ToF 派生の間引き）\*\*を検討すると安定します。

---

### まとめ一言

- **“IMU だけ”ではなく複数モダリティをがっつり使っている**。
- **特徴量数の主役は ToF（\~90%超）**、IMU は**数では少ないが意味のある軸**（周波数・ジャーク・線形/世界座標・角速度など）を網羅。
- Thermal/品質/クロス系は**補助的**に効かせている、という構成です。
