🔴 重大な不足（コア機能）

1. ToF PCA 実装が完全に欠落

- plan-pro.md: 64→8 次元の PCA 圧縮が明記されているが未実装
- CONFIG には tof_pca_components: 8 があるが、実際の PCA 処理なし

2. 多解像度窓処理（S/M/L）が未実装

- plan-thinking.md: 1-1.5 秒、3-4 秒、10-12.8 秒の 3 段階窓
- 末尾重視の TTA（Test Time Augmentation）も未実装

3. Handedness（利き手）対応が未実装

- ToF センサーの左右反転処理なし
- 両計画書で重要視されている機能

🟡 中程度の不足（精度向上に重要）

IMU 関連：

- Line Length（|差分|の総和）
- 自己相関（ラグ 1,2,4,8）
- 水平/垂直成分分解（world 座標の z 軸と xy 平面）
- linacc_mag と omega_mag の相関
- 勾配ヒストグラム

ToF 関連：

- 領域別統計（中心 3×3、内環、外環、4 象限）
- near_frac(q)（距離の下位 q 分位未満のセル比率）
- アナイソトロピー（主成分の固有値比）
- クラスタリング特徴（最大連結成分の面積/周囲長/円形度）
- 主成分角度
- 局所コントラスト
- min_dist の加速度（二次差分）
- 区間統計（3 分割）

Thermal 関連：

- 二次差分
- 変化イベント率（|差分|>閾値の割合）
- 分位幅（p90-p10 の spread）

クロスモーダル：

- ミクロ同期（linacc_mag ピーク近傍での min_dist 低下量）
- 整合度（IMU 進行方向と ToF 面の一致）
- トリプレット（min_dist 低下 →Thermal 上昇 →linacc ピークの順序）

🟢 部分的実装（改善の余地あり）

- ToF の時間方向特徴は速度のみ（加速度が未実装）
- クロスモーダル特徴が単純な比率のみ
- Thermal×ToF 連携が基本的な乗算のみ

提案

最も重要な不足機能から優先的に追加すべきです：

1. ToF PCA 実装（空間圧縮）
2. 多解像度窓処理と TTA
3. Handedness 対応
4. IMU の詳細特徴（line length、自己相関等）
5. ToF 領域別統計

これらを追加実装することで、計画書の仕様を完全に満たし、精度向上が期待できます。
