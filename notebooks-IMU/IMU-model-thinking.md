いいね、ここまでの 3 本（あなたが置いてくれたノートブック）を実際に中身まで読んで、”どんな特徴量・どんなモデル・どんなアンサンブルか”を整理しました。要点だけサクッと 👇

# ざっくり比較表

| ノートブック                                            | 入力モダリティ                         | 主要な特徴量ブロック                                                                                                                                                                                              | 学習モデル/設定                                                         | アンサンブル/後処理                                                                                                                 |
| ------------------------------------------------------- | -------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| **imu-only-baseline-lgbm-using-worldacc.ipynb**         | IMU（acc_x/y/z, rot_w/x/y/z）          | - **ワールド座標加速度**（四元数で回転）<br>- 軸別・合成の基本統計（mean/std/min/max/median/分位/IQR/レンジ/CV/歪度/尖度/先頭/末尾/デルタ/差分統計/区間 3 分割のセグ統計）<br>- 加速度/回転の相関                 | **LightGBM**（GPU/`gpu_hist`想定）<br>**StratifiedGroupKFold=5** で訓練 | **各 fold モデルの多数決**（確率でなくクラス投票）で最終予測                                                                        |
| **cmi-bfrb-imu-inference-v10-frequency-features.ipynb** | IMU のみ                               | - **周波数特徴**（FFT ベース：支配周波数/パワー/スペクトル重心/ロールオフ(85%)/エントロピー/ゼロ交差率）<br>- **変化点特徴**（CUSUM 風：変化点数/セグ長など）<br>- 合成加速度の統計・**ジャーク**・回転エネルギー | **LightGBM の事前学習モデルを pkl からロード**（fold ごとに複数）       | **重み付き平均アンサンブル**（例： `[1.0,1.15,0.95,1.05,1.1]` で確率加重平均）→ **BFRB クラスの確率ブースト**や低信頼時の再調整あり |
| **cmi-lightgbm-tof-pro-v1.ipynb**                       | IMU + **ToF**(8×8×5) + **Thermal**(×5) | - IMU 基本統計<br>- **ToF 集約統計**（各センサ 64 ピクセルの mean/std、**-1 の比率**など）※空間(領域)特徴や PCA は未実装<br>- Thermal 基本統計                                                                    | **LightGBM**（単一モデル）<br>**train/val の単純分割**                  | **アンサンブルなし**（単モデル）                                                                                                    |

---

## もう少しだけ補足

- **IMU ワールド座標化**は “imu-only…” でしっかりやれており、姿勢依存のばらつき低減に効いています。一方、**周波数＋変化点**は “frequency-features…” に寄っていて、こちらは**fold 加重の確率平均**＋**BFRB ブースト**で最終決定。
- **ToF/THM 側**は現状「平均・分散・欠損比率」などの**時系列を潰した集約中心**で、**空間（8×8 の領域/重心/半径方向/左右非対称）**や**PCA/再構成誤差**、**センサ間同期**といった上位勢がよく使う層はまだ未着手です（あなたの Advanced FE スクリプトではここをだいぶ拡張しているので、次に統合すると良さげ）。

---

## “設計とのギャップ”メモ（超要約）

- **IMU**

  - “imu-only…”：ワールド化＋統計は良好。ただ**周波数/Hjorth/ウェーブレット/Welch-PSD**は未搭載。
  - “frequency-features…”：周波数&変化点は OK だが、**ワールド化**や**線形加速度**まわりは薄い。
    → ベストは**両方の長所を足して**同じ特徴セットで学習すること。

- **ToF/THM**

  - “tof-pro…”：**空間 × 時系列**の二軸が弱い（空間は平均系、時系列は非活用）。
    → **8×8 空間モーメント/重心/同心円/領域差分/クラスタ特性**＋\*\*min 距離系列のイベント率や同時発火（センサ同期）\*\*などを追加したい。

- **アンサンブル**

  - IMU（周波数版）は**確率加重平均**＋**ポストプロセス**、IMU（ワールド版）は**多数決**、ToF/THM は**単発**。
    → 本線は「**各モダリティごとに CV モデルの確率平均**→**モダリティ間を遅延融合（重み or ロジスティック/小さなメタモデル）**」が堅いです。BFRB vs 非 BFRB の**ゲート**（まず 2 値、その後 BFRB 内で多クラス）も有効。

---

## すぐできる実務的なおすすめ

1. **IMU 特徴の統合**

   - “imu-only…”の**ワールド化＋線形加速度**と、“frequency…”の**FFT/変化点/ジャーク**を**同じパイプライン**にまとめ、**同じ学習データ**で**CV LightGBM/XGBoost**を回す。
   - fold 内は**確率平均**に統一（多数決よりスコアが安定しやすい）。

2. **ToF/THM の格上げ**

   - 8×8 から**重心・モーメント・偏心率・四分割/同心円/リング差分・左右/上下非対称**、**min 距離系列の到来イベント率/最長持続/センサ間同期**を追加。
   - まずは**CV 化**（今は hold-out）。

3. **最終融合**

   - IMU 系（ワールド＋周波数）と ToF/THM 系を**確率の加重平均**で後段融合（重みは CV のバリデ成績で決める）。
   - 低信頼（max prob 低）時の**BFRB 優遇**などの後処理はそのまま活かす。

必要なら、この 3 本を\*\*単一の`deep.py`/`blend.py`\*\*に収束させる設計スケッチも出します。どこから統合したい？（IMU 統合 →ToF 強化 → 最終ブレンディング、の順が手戻り少ないです。）
